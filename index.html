<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Commons - Complete System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0a0a0a;
            --bg-card: #1a1a1a;
            --text: #ffffff;
            --text-dim: #808080;
            --green: #00ff88;
            --blue: #00ddff;
            --purple: #9945ff;
            --red: #ff3366;
            --yellow: #ffaa00;
            --border: #2a2a2a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .pod-title {
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }

        .pod-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            font-size: 1.2rem;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--green);
        }

        .stat-label {
            color: var(--text-dim);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 40px;
            background: var(--bg-card);
            padding: 8px;
            border-radius: 12px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-dim);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-tab:hover {
            color: var(--text);
        }

        .nav-tab.active {
            background: var(--bg);
            color: var(--green);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* View Mode Toggle */
        .view-toggle {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .view-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-btn.active {
            background: var(--green);
            color: var(--bg);
            border-color: var(--green);
        }

        /* Collapsible Triads - Icon View */
        .triads {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .triad {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .triad.collapsed {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .triad-header {
            padding: 16px 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .triad-header:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .triad-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .collapse-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .triad.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .triad-title {
            font-size: 0.75rem;
            letter-spacing: 3px;
            color: var(--text-dim);
        }

        .triad-description {
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        .triad-summary {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .role-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .role-indicator.filled {
            background: var(--green);
        }

        .role-indicator.empty {
            background: var(--red);
        }

        .triad-status {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* Roles Content - Collapsible */
        .roles-content {
            padding: 0 24px 24px;
            max-height: 1000px;
            opacity: 1;
            transition: all 0.3s ease;
        }

        .triad.collapsed .roles-content {
            max-height: 0;
            opacity: 0;
            padding: 0 24px;
            overflow: hidden;
        }

        /* Icon View - Compact */
        .roles.icon-view {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .role.icon-view {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            width: calc(33.333% - 11px);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .role.icon-view:hover {
            transform: translateY(-2px);
            border-color: var(--green);
        }

        .role.icon-view.filled {
            border-color: var(--green);
        }

        .role.icon-view.empty {
            border-color: var(--red);
            opacity: 0.8;
        }

        .role-compact {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 8px;
        }

        .role-icon {
            font-size: 2rem;
        }

        .role-name {
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-people-count {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.1);
            color: var(--green);
        }

        .role-people-count.empty {
            background: rgba(255, 51, 102, 0.1);
            color: var(--red);
        }

        /* Table View */
        .roles.table-view {
            width: 100%;
        }

        .role-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        .role-table th {
            text-align: left;
            padding: 8px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            border-bottom: 1px solid var(--border);
        }

        .role-table td {
            padding: 12px 8px;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        .role-table tr td:first-child {
            border-radius: 8px 0 0 8px;
        }

        .role-table tr td:last-child {
            border-radius: 0 8px 8px 0;
        }

        .role-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .role-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.filled {
            background: var(--green);
        }

        .status-dot.empty {
            background: var(--red);
        }

        .people-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .person-tag {
            padding: 2px 8px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--green);
        }

        .person-tag.backup {
            background: rgba(255, 170, 0, 0.1);
            border-color: rgba(255, 170, 0, 0.3);
            color: var(--yellow);
        }

        .empty-tag {
            padding: 2px 8px;
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid rgba(255, 51, 102, 0.3);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--red);
            font-style: italic;
        }

        .add-btn {
            padding: 2px 8px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-btn:hover {
            border-color: var(--green);
            color: var(--green);
        }

        /* Flows Tab */
        .operator-model {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 40px;
        }

        .core-operator {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
        }

        .core-operator.shares {
            border-color: var(--blue);
        }

        .core-operator.okays {
            border-color: var(--purple);
        }

        .core-operator.does {
            border-color: var(--green);
        }

        .core-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .core-title {
            font-size: 1.3rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .shares .core-title { color: var(--blue); }
        .okays .core-title { color: var(--purple); }
        .does .core-title { color: var(--green); }

        .core-description {
            font-size: 0.85rem;
            color: var(--text-dim);
            font-style: italic;
        }

        .detailed-operators {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .operator-item {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .operator-item:hover {
            transform: translateX(4px);
        }

        .shares .operator-item:hover { border-color: var(--blue); }
        .okays .operator-item:hover { border-color: var(--purple); }
        .does .operator-item:hover { border-color: var(--green); }

        .operator-name {
            font-weight: 600;
            text-transform: capitalize;
            margin-bottom: 4px;
        }

        .operator-desc {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* Flows Section */
        .flows-section {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
        }

        .flows-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .flows-header h3 {
            font-size: 1.5rem;
            font-weight: 300;
        }

        .flow-type-toggle {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 4px;
        }

        .flow-type-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flow-type-btn.active {
            background: var(--bg);
            color: var(--text);
        }

        .toggle-view {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 4px;
        }

        .toggle-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toggle-btn.active {
            background: var(--bg);
            color: var(--text);
        }

        .flows-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .flow-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            transition: all 0.2s ease;
        }

        .flow-item:hover {
            border-color: var(--green);
        }

        .flow-item.shares-flow { border-left: 4px solid var(--blue); }
        .flow-item.okays-flow { border-left: 4px solid var(--purple); }
        .flow-item.does-flow { border-left: 4px solid var(--green); }

        .flow-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .flow-role {
            padding: 8px 12px;
            background: var(--bg);
            border-radius: 6px;
            font-weight: 600;
            white-space: nowrap;
        }

        .flow-arrow {
            color: var(--text-dim);
            font-size: 1.2rem;
        }

        .flow-operator {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            white-space: nowrap;
        }

        .shares-flow .flow-operator {
            background: rgba(0, 221, 255, 0.1);
            border: 1px solid var(--blue);
            color: var(--blue);
        }

        .okays-flow .flow-operator {
            background: rgba(153, 69, 255, 0.1);
            border: 1px solid var(--purple);
            color: var(--purple);
        }

        .does-flow .flow-operator {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .flow-operand {
            flex: 1;
            font-style: italic;
            color: var(--text-dim);
        }

        .flow-meta {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .flow-timestamp {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .flow-consent {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .consent-status {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .consent-status.approved {
            background: rgba(0, 255, 136, 0.1);
            color: var(--green);
        }

        .consent-status.pending {
            background: rgba(255, 170, 0, 0.1);
            color: var(--yellow);
        }

        .consent-status.rejected {
            background: rgba(255, 51, 102, 0.1);
            color: var(--red);
        }

        .consent-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .consent-btn {
            padding: 4px 8px;
            background: transparent;
            border: 1px solid var(--green);
            border-radius: 4px;
            color: var(--green);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .consent-btn:hover {
            background: var(--green);
            color: var(--bg);
        }

        .consent-btn.reject {
            border-color: var(--red);
            color: var(--red);
        }

        .consent-btn.reject:hover {
            background: var(--red);
            color: var(--bg);
        }

        .flow-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .flow-item:hover .flow-actions {
            opacity: 1;
        }

        .flow-btn {
            padding: 4px 8px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-dim);
            font-size: 0.75rem;
            cursor: pointer;
        }

        .flow-btn:hover {
            border-color: var(--green);
            color: var(--green);
        }

        .add-flow-btn {
            margin-top: 20px;
            width: 100%;
            padding: 16px;
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: var(--text-dim);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-flow-btn:hover {
            border-color: var(--green);
            color: var(--green);
        }

        /* Tasks System */
        .tasks-section {
            padding: 20px 0;
        }

        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .tasks-header h2 {
            font-size: 1.8rem;
            font-weight: 300;
        }

        .tasks-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .task-filter {
            padding: 10px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
        }

        /* Flow-Task List */
        .flow-task-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .flow-task-group {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .flow-task-group.collapsed .flow-task-content {
            display: none;
        }

        .flow-task-header {
            padding: 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flow-task-header:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .flow-task-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flow-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .flow-expand-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }

        .flow-task-group.collapsed .flow-expand-icon {
            transform: rotate(-90deg);
        }

        .flow-path {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .flow-path .role {
            padding: 6px 12px;
            background: var(--bg);
            border-radius: 6px;
            font-weight: 600;
        }

        .flow-path .operator {
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .shares-operator {
            background: rgba(0, 221, 255, 0.1);
            border: 1px solid var(--blue);
            color: var(--blue);
        }

        .does-operator {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .okays-operator {
            background: rgba(153, 69, 255, 0.1);
            border: 1px solid var(--purple);
            color: var(--purple);
        }

        .flow-stats {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .flow-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }

        .stat-label {
            color: var(--text-dim);
        }

        .stat-value {
            font-weight: 600;
        }

        .create-task-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--green);
            border-radius: 6px;
            color: var(--green);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .create-task-btn:hover {
            background: var(--green);
            color: var(--bg);
        }

        /* Task Content Area */
        .flow-task-content {
            padding: 20px;
        }

        .task-columns {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .task-column {
            min-height: 100px;
        }

        .task-column-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 12px;
            letter-spacing: 1px;
        }

        .task-column-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .task-card.shares-task {
            border-left: 3px solid var(--blue);
        }

        .task-card.does-task {
            border-left: 3px solid var(--green);
        }

        .task-card.okays-task {
            border-left: 3px solid var(--purple);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .task-id {
            font-size: 0.7rem;
            color: var(--text-dim);
            font-family: monospace;
        }

        .task-priority {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
        }

        .task-priority.high {
            background: var(--red);
            animation: pulse-priority 2s ease-in-out infinite;
        }

        @keyframes pulse-priority {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .task-priority.medium {
            background: var(--yellow);
        }

        .task-priority.low {
            background: var(--green);
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }

        .task-chain-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chain-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--green);
        }

        .chain-line {
            width: 12px;
            height: 1px;
            background: var(--green);
        }

        .chain-count {
            font-size: 0.7rem;
            padding: 2px 6px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            color: var(--green);
        }

        .task-assignee {
            font-size: 0.75rem;
            padding: 2px 6px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 4px;
            color: var(--green);
        }

        .empty-state {
            padding: 40px;
            text-align: center;
            color: var(--text-dim);
        }

        .empty-state-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* People Section */
        .people-section {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
        }

        .people-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .people-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .person-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .person-card:hover {
            border-color: var(--green);
            transform: translateY(-2px);
        }

        .person-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--green), var(--blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg);
        }

        .person-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .person-role-count {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* Network Tab - Pod Connections */
        .network-section {
            padding: 20px 0;
        }

        .network-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .network-header h2 {
            font-size: 1.8rem;
            font-weight: 300;
        }

        .pod-selector {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .current-pod-label {
            padding: 8px 16px;
            background: var(--green);
            color: var(--bg);
            border-radius: 6px;
            font-weight: 600;
        }

        .connected-pods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        .pod-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.2s ease;
        }

        .pod-card:hover {
            border-color: var(--green);
            transform: translateY(-2px);
        }

        .pod-card.current {
            border-color: var(--green);
            background: rgba(0, 255, 136, 0.05);
        }

        .pod-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .pod-name {
            font-size: 1.2rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pod-health {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 4px;
        }

        .health-value {
            color: var(--green);
            font-weight: 600;
        }

        .pod-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .pod-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
        }

        .pod-stat-value {
            font-weight: 600;
        }

        .pod-stat-label {
            color: var(--text-dim);
        }

        .pod-flows {
            border-top: 1px solid var(--border);
            padding-top: 12px;
        }

        .pod-flow-count {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .pod-flow-indicators {
            display: flex;
            gap: 8px;
        }

        .flow-indicator {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: var(--border);
        }

        .flow-indicator.shares { background: var(--blue); }
        .flow-indicator.does { background: var(--green); }
        .flow-indicator.okays { background: var(--purple); }

        .add-pod-btn {
            width: 100%;
            padding: 40px;
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: var(--text-dim);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-pod-btn:hover {
            border-color: var(--green);
            color: var(--green);
        }

        .add-pod-icon {
            font-size: 2rem;
            opacity: 0.5;
        }

        .pod-flows-list {
            margin-top: 40px;
        }

        .pod-flow-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pod-flow-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .pod-badge {
            padding: 6px 12px;
            background: var(--bg);
            border: 2px solid var(--green);
            border-radius: 6px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .pod-flow-item.shares-flow .flow-operator {
            background: rgba(0, 221, 255, 0.1);
            border: 1px solid var(--blue);
            color: var(--blue);
        }

        .pod-flow-item.okays-flow .flow-operator {
            background: rgba(153, 69, 255, 0.1);
            border: 1px solid var(--purple);
            color: var(--purple);
        }

        .pod-flow-item.does-flow .flow-operator {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .flow-builder {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .builder-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .builder-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Custom Select Dropdown */
        .custom-select {
            position: relative;
            width: 100%;
        }

        .select-trigger {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .select-trigger:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .select-trigger.active {
            border-color: var(--green);
        }

        .select-arrow {
            width: 12px;
            height: 12px;
            border-right: 2px solid var(--text-dim);
            border-bottom: 2px solid var(--text-dim);
            transform: rotate(45deg);
            transition: transform 0.2s ease;
            margin-top: -4px;
        }

        .select-trigger.active .select-arrow {
            transform: rotate(-135deg);
            margin-top: 2px;
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .select-options.active {
            display: block;
        }

        .select-option {
            padding: 12px 16px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 3px solid transparent;
        }

        .select-option:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--green);
            padding-left: 20px;
        }

        .select-option.selected {
            background: rgba(0, 255, 136, 0.1);
            color: var(--green);
        }

        .builder-select,
        .builder-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .builder-input:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .builder-input:focus {
            outline: none;
            border-color: var(--green);
            background: rgba(0, 255, 136, 0.05);
        }

        .builder-input::placeholder {
            color: var(--text-dim);
        }

        .operator-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .operator-option {
            padding: 12px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .operator-option:hover {
            border-color: var(--green);
        }

        .operator-option.selected {
            border-color: var(--green);
            background: rgba(0, 255, 136, 0.1);
        }

        .operator-option.shares { border-color: var(--blue); }
        .operator-option.okays { border-color: var(--purple); }
        .operator-option.does { border-color: var(--green); }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn-primary {
            background: var(--green);
            color: var(--bg);
        }

        .modal-btn-cancel {
            background: transparent;
            color: var(--text);
            border: 2px solid var(--border);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .task-columns {
                grid-template-columns: 1fr;
            }
            
            .role.icon-view {
                width: calc(50% - 8px);
            }
            
            .triads {
                gap: 8px;
            }
        }

        @media (max-width: 600px) {
            .pod-stats {
                flex-wrap: wrap;
                gap: 20px;
            }
            
            .role.icon-view {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="pod-title">NORTHSIDE RESPONSE</h1>
            <div class="pod-stats">
                <div class="stat">
                    <span class="stat-value">87%</span>
                    <span class="stat-label">Health</span>
                </div>
                <div class="stat">
                    <span class="stat-value">7/9</span>
                    <span class="stat-label">Roles Filled</span>
                </div>
                <div class="stat">
                    <span class="stat-value">12</span>
                    <span class="stat-label">Active Flows</span>
                </div>
                <div class="stat">
                    <span class="stat-value">12</span>
                    <span class="stat-label">People</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('roles', this)">Roles</button>
            <button class="nav-tab" onclick="switchTab('flows', this)">Flows</button>
            <button class="nav-tab" onclick="switchTab('tasks', this)">Tasks</button>
            <button class="nav-tab" onclick="switchTab('people', this)">People</button>
            <button class="nav-tab" onclick="switchTab('network', this)">Network</button>
        </div>

        <!-- Roles Tab -->
        <div class="tab-content active" id="rolesTab">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="view-btn active" onclick="toggleRoleView('icon')">Icon View</button>
                <button class="view-btn" onclick="toggleRoleView('table')">Table View</button>
            </div>

            <div class="triads" id="triadsContainer">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Flows Tab -->
        <div class="tab-content" id="flowsTab">
            <div class="operator-model">
                <!-- SHARES -->
                <div class="core-operator shares">
                    <div class="core-header">
                        <div class="core-title">SHARES</div>
                        <div class="core-description">Make it visible</div>
                    </div>
                    <div class="detailed-operators">
                        <div class="operator-item" onclick="selectOperator('spot', 'shares')">
                            <div class="operator-name">Spot</div>
                            <div class="operator-desc">Notice gaps, risks, missing pieces</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('define', 'shares')">
                            <div class="operator-name">Define</div>
                            <div class="operator-desc">Create shared language & standards</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('bound', 'shares')">
                            <div class="operator-name">Bound</div>
                            <div class="operator-desc">Set scope and access (in/out)</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('reflect', 'shares')">
                            <div class="operator-name">Reflect</div>
                            <div class="operator-desc">Capture what happened, share lessons</div>
                        </div>
                    </div>
                </div>

                <!-- OKAYS -->
                <div class="core-operator okays">
                    <div class="core-header">
                        <div class="core-title">OKAYS</div>
                        <div class="core-description">Check, align & ratchet</div>
                    </div>
                    <div class="detailed-operators">
                        <div class="operator-item" onclick="selectOperator('integrate', 'okays')">
                            <div class="operator-name">Integrate</div>
                            <div class="operator-desc">Align overlapping efforts</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('pace', 'okays')">
                            <div class="operator-name">Pace</div>
                            <div class="operator-desc">Keep timing sustainable & in sync</div>
                        </div>
                    </div>
                </div>

                <!-- DOES -->
                <div class="core-operator does">
                    <div class="core-header">
                        <div class="core-title">DOES</div>
                        <div class="core-description">Do the work</div>
                    </div>
                    <div class="detailed-operators">
                        <div class="operator-item" onclick="selectOperator('build', 'does')">
                            <div class="operator-name">Build</div>
                            <div class="operator-desc">Create tools, kits, prototypes</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('connect', 'does')">
                            <div class="operator-name">Connect</div>
                            <div class="operator-desc">Link people, flows & resources</div>
                        </div>
                        <div class="operator-item" onclick="selectOperator('protect', 'does')">
                            <div class="operator-name">Protect</div>
                            <div class="operator-desc">Add backups & resilience</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flows List -->
            <div class="flows-section">
                <div class="flows-header">
                    <h3>Active Process Flows</h3>
                    <div class="toggle-view">
                        <button class="toggle-btn active" onclick="setView('simple')">Simple (3)</button>
                        <button class="toggle-btn" onclick="setView('detailed')">Detailed (9)</button>
                    </div>
                </div>

                <button class="add-flow-btn" onclick="openFlowBuilder()">+ Create New Flow</button>

                <div class="flows-list" id="flowsList">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div class="tab-content" id="tasksTab">
            <div class="tasks-section">
                <div class="tasks-header">
                    <h2>Task Flows</h2>
                    <div class="tasks-controls">
                        <select class="task-filter" id="taskFilter" onchange="filterTasks()">
                            <option value="all">All Tasks</option>
                            <option value="active">Active</option>
                            <option value="my-role">My Role</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <div class="flow-task-list" id="flowTaskList">
                    <!-- Flow-grouped tasks will be generated here -->
                </div>
            </div>
        </div>

        <!-- People Tab -->
        <div class="tab-content" id="peopleTab">
            <div class="people-section">
                <div class="people-header">
                    <h2>People in Pod</h2>
                    <p style="color: var(--text-dim);">12 members total</p>
                </div>
                <div class="people-grid" id="peopleGrid">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Network Tab -->
        <div class="tab-content" id="networkTab">
            <div class="network-section">
                <div class="network-header">
                    <h2>Pod Network</h2>
                    <div class="pod-selector">
                        <span style="color: var(--text-dim);">Current Pod:</span>
                        <span class="current-pod-label">NORTHSIDE RESPONSE</span>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; font-weight: 300;">Connected Pods</h3>
                <div class="connected-pods" id="connectedPods">
                    <!-- Will be populated by JavaScript -->
                </div>

                <h3 style="margin: 40px 0 20px; font-weight: 300;">Inter-Pod Flows</h3>
                <div class="flows-header">
                    <div>Active connections between pods</div>
                    <div class="flow-type-toggle">
                        <button class="flow-type-btn active" onclick="setFlowType('all')">All Flows</button>
                        <button class="flow-type-btn" onclick="setFlowType('incoming')">Incoming</button>
                        <button class="flow-type-btn" onclick="setFlowType('outgoing')">Outgoing</button>
                    </div>
                </div>

                <button class="add-flow-btn" onclick="openPodFlowBuilder()">+ Create Pod Connection</button>

                <div class="pod-flows-list" id="podFlowsList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Flow Builder Modal -->
    <div class="modal" id="flowModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Process Flow</h3>
                <p style="color: var(--text-dim);">Define how roles interact through operators</p>
            </div>
            
            <div class="flow-builder">
                <div class="builder-row">
                    <label class="builder-label">From Role</label>
                    <div class="custom-select" id="fromRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('fromRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="fromRoleOptions">
                            <div class="select-option" onclick="selectOption('fromRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">Core Operator Category</label>
                    <div class="operator-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="operator-option shares" data-core="shares" onclick="selectCoreCategory('shares')">
                            <div style="font-weight: bold;">SHARES</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Make visible</div>
                        </div>
                        <div class="operator-option does" data-core="does" onclick="selectCoreCategory('does')">
                            <div style="font-weight: bold;">DOES</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Do the work</div>
                        </div>
                        <div class="operator-option okays" data-core="okays" onclick="selectCoreCategory('okays')">
                            <div style="font-weight: bold;">OKAYS</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Align & ratchet</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row" id="detailedOperatorRow" style="display: none;">
                    <label class="builder-label">Specific Operator (Optional)</label>
                    <div class="operator-grid" id="operatorGrid">
                        <!-- Will be dynamically populated based on selected core category -->
                    </div>
                    <div style="margin-top: 8px; font-size: 0.75rem; color: var(--text-dim); text-align: center;">
                        Leave blank to use the core operator only
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">What (Operand)</label>
                    <input type="text" class="builder-input" id="operand" placeholder="e.g., emerging risks, resource needs, sprint cycles...">
                </div>

                <div class="builder-row">
                    <label class="builder-label">Preposition</label>
                    <div class="custom-select" id="prepositionSelect">
                        <div class="select-trigger" onclick="toggleDropdown('preposition')">
                            <span class="select-value" data-value="to">to</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="prepositionOptions">
                            <div class="select-option selected" onclick="selectOption('preposition', 'to')">to</div>
                            <div class="select-option" onclick="selectOption('preposition', 'with')">with</div>
                            <div class="select-option" onclick="selectOption('preposition', 'through')">through</div>
                            <div class="select-option" onclick="selectOption('preposition', 'for')">for</div>
                            <div class="select-option" onclick="selectOption('preposition', 'from')">from</div>
                            <div class="select-option" onclick="selectOption('preposition', 'by')">by</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">To Role</label>
                    <div class="custom-select" id="toRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('toRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="toRoleOptions">
                            <div class="select-option" onclick="selectOption('toRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="createFlow()">Create Flow</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Pod Flow Builder Modal -->
    <div class="modal" id="podFlowModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Pod Connection</h3>
                <p style="color: var(--text-dim);">Connect pods using the same flow grammar</p>
            </div>
            
            <div class="flow-builder">
                <div class="builder-row">
                    <label class="builder-label">Connection Type</label>
                    <div class="operator-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="operator-option" data-type="role-to-role" onclick="setPodFlowType('role-to-role')">
                            <div style="font-weight: bold;">Role → Role</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Cross-pod role flow</div>
                        </div>
                        <div class="operator-option" data-type="pod-to-role" onclick="setPodFlowType('pod-to-role')">
                            <div style="font-weight: bold;">Pod → Role</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Pod-level to role</div>
                        </div>
                        <div class="operator-option selected" data-type="pod-to-pod" onclick="setPodFlowType('pod-to-pod')">
                            <div style="font-weight: bold;">Pod → Pod</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Pod-level flow</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row" id="podFromRow">
                    <label class="builder-label">From</label>
                    <input type="text" class="builder-input" id="podFrom" value="NORTHSIDE RESPONSE" readonly style="background: rgba(0, 255, 136, 0.05);">
                </div>

                <div class="builder-row" id="podFromRoleRow" style="display: none;">
                    <label class="builder-label">From Role (in NORTHSIDE)</label>
                    <div class="custom-select" id="podFromRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('podFromRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="podFromRoleOptions">
                            <div class="select-option" onclick="selectOption('podFromRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('podFromRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">Core Operator</label>
                    <div class="operator-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="operator-option shares" data-core="shares" onclick="selectPodCoreCategory('shares')">
                            <div style="font-weight: bold;">SHARES</div>
                        </div>
                        <div class="operator-option does" data-core="does" onclick="selectPodCoreCategory('does')">
                            <div style="font-weight: bold;">DOES</div>
                        </div>
                        <div class="operator-option okays" data-core="okays" onclick="selectPodCoreCategory('okays')">
                            <div style="font-weight: bold;">OKAYS</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">What (Operand)</label>
                    <input type="text" class="builder-input" id="podOperand" placeholder="e.g., regional patterns, shared resources, coordination...">
                </div>

                <div class="builder-row">
                    <label class="builder-label">To Pod</label>
                    <div class="custom-select" id="toPodSelect">
                        <div class="select-trigger" onclick="toggleDropdown('toPod')">
                            <span class="select-value" data-value="">Select pod...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="toPodOptions">
                            <div class="select-option" onclick="selectOption('toPod', 'SOUTH DISTRICT')">SOUTH DISTRICT</div>
                            <div class="select-option" onclick="selectOption('toPod', 'CENTRAL COMMAND')">CENTRAL COMMAND</div>
                            <div class="select-option" onclick="selectOption('toPod', 'MEDICAL SECTOR')">MEDICAL SECTOR</div>
                            <div class="select-option" onclick="selectOption('toPod', '[New Pod]')">[New Pod]</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row" id="podToRoleRow" style="display: none;">
                    <label class="builder-label">To Role (in target pod)</label>
                    <div class="custom-select" id="podToRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('podToRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="podToRoleOptions">
                            <div class="select-option" onclick="selectOption('podToRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('podToRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="createPodFlow()">Create Connection</button>
                <button class="modal-btn modal-btn-cancel" onclick="closePodModal()">Cancel</button>
            </div>
        </div>
    </div>
    <div class="modal" id="flowModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Process Flow</h3>
                <p style="color: var(--text-dim);">Define how roles interact through operators</p>
            </div>
            
            <div class="flow-builder">
                <div class="builder-row">
                    <label class="builder-label">From Role</label>
                    <div class="custom-select" id="fromRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('fromRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="fromRoleOptions">
                            <div class="select-option" onclick="selectOption('fromRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('fromRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">Core Operator Category</label>
                    <div class="operator-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="operator-option shares" data-core="shares" onclick="selectCoreCategory('shares')">
                            <div style="font-weight: bold;">SHARES</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Make visible</div>
                        </div>
                        <div class="operator-option does" data-core="does" onclick="selectCoreCategory('does')">
                            <div style="font-weight: bold;">DOES</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Do the work</div>
                        </div>
                        <div class="operator-option okays" data-core="okays" onclick="selectCoreCategory('okays')">
                            <div style="font-weight: bold;">OKAYS</div>
                            <div style="font-size: 0.7rem; margin-top: 4px;">Align & ratchet</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row" id="detailedOperatorRow" style="display: none;">
                    <label class="builder-label">Specific Operator (Optional)</label>
                    <div class="operator-grid" id="operatorGrid">
                        <!-- Will be dynamically populated based on selected core category -->
                    </div>
                    <div style="margin-top: 8px; font-size: 0.75rem; color: var(--text-dim); text-align: center;">
                        Leave blank to use the core operator only
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">What (Operand)</label>
                    <input type="text" class="builder-input" id="operand" placeholder="e.g., emerging risks, resource needs, sprint cycles...">
                </div>

                <div class="builder-row">
                    <label class="builder-label">Preposition</label>
                    <div class="custom-select" id="prepositionSelect">
                        <div class="select-trigger" onclick="toggleDropdown('preposition')">
                            <span class="select-value" data-value="to">to</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="prepositionOptions">
                            <div class="select-option selected" onclick="selectOption('preposition', 'to')">to</div>
                            <div class="select-option" onclick="selectOption('preposition', 'with')">with</div>
                            <div class="select-option" onclick="selectOption('preposition', 'through')">through</div>
                            <div class="select-option" onclick="selectOption('preposition', 'for')">for</div>
                            <div class="select-option" onclick="selectOption('preposition', 'from')">from</div>
                            <div class="select-option" onclick="selectOption('preposition', 'by')">by</div>
                        </div>
                    </div>
                </div>

                <div class="builder-row">
                    <label class="builder-label">To Role</label>
                    <div class="custom-select" id="toRoleSelect">
                        <div class="select-trigger" onclick="toggleDropdown('toRole')">
                            <span class="select-value" data-value="">Select role...</span>
                            <span class="select-arrow"></span>
                        </div>
                        <div class="select-options" id="toRoleOptions">
                            <div class="select-option" onclick="selectOption('toRole', 'Starter')">Starter</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Definer')">Definer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Builder')">Builder</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Divider')">Divider</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Connector')">Connector</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Integrator')">Integrator</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Balancer')">Balancer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Overlayer')">Overlayer</div>
                            <div class="select-option" onclick="selectOption('toRole', 'Reflector')">Reflector</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="createFlow()">Create Flow</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentTab = 'roles';
        let viewMode = 'simple';
        let roleViewMode = 'icon';
        let expandedTriads = new Set(['creation', 'structure', 'continuity']); // Start expanded
        let selectedOperator = null;
        let selectedCategory = null;
        let selectedCoreCategory = null;
        let expandedFlows = new Set();
        let podFlowType = 'pod-to-pod';
        let selectedPodCoreCategory = null;
        let flowTypeFilter = 'all';

        // Current pod info
        const currentPod = {
            name: 'NORTHSIDE RESPONSE',
            health: 87,
            rolesFilled: 7,
            totalRoles: 9,
            activeFlows: 12,
            people: 12
        };

        // Connected pods data
        const connectedPods = [
            {
                name: 'SOUTH DISTRICT',
                health: 92,
                rolesFilled: 8,
                totalRoles: 9,
                activeFlows: 8,
                flowTypes: { shares: 3, does: 3, okays: 2 }
            },
            {
                name: 'CENTRAL COMMAND',
                health: 95,
                rolesFilled: 9,
                totalRoles: 9,
                activeFlows: 15,
                flowTypes: { shares: 6, does: 5, okays: 4 }
            },
            {
                name: 'MEDICAL SECTOR',
                health: 78,
                rolesFilled: 6,
                totalRoles: 9,
                activeFlows: 10,
                flowTypes: { shares: 4, does: 4, okays: 2 }
            }
        ];

        // Pod-to-pod flows
        const podFlows = [
            {
                type: 'pod-to-pod',
                from: 'NORTHSIDE RESPONSE',
                fromRole: null,
                operator: 'shares',
                operand: 'regional risk patterns',
                to: 'CENTRAL COMMAND',
                toRole: null,
                category: 'shares',
                timestamp: new Date(Date.now() - 3600000).toISOString(),
                consent: { from: 'approved', to: 'approved' }
            },
            {
                type: 'role-to-role',
                from: 'NORTHSIDE RESPONSE',
                fromRole: 'Connector',
                operator: 'connect',
                operand: 'medical resources',
                to: 'MEDICAL SECTOR',
                toRole: 'Builder',
                category: 'does',
                timestamp: new Date(Date.now() - 7200000).toISOString(),
                consent: { from: 'approved', to: 'approved' }
            },
            {
                type: 'pod-to-role',
                from: 'CENTRAL COMMAND',
                fromRole: null,
                operator: 'okays',
                operand: 'resource allocation',
                to: 'NORTHSIDE RESPONSE',
                toRole: 'Balancer',
                category: 'okays',
                timestamp: new Date(Date.now() - 1800000).toISOString(),
                consent: { from: 'approved', to: 'pending' }
            }
        ];

        // Data
        const triadsData = [
            {
                id: 'creation',
                title: 'CREATION',
                description: 'Beginning Phase',
                roles: [
                    { name: 'Starter', icon: '🚀', description: 'Spots gaps, raises alarm', people: ['SilverFox'] },
                    { name: 'Definer', icon: '📋', description: 'Sets success criteria', people: ['CrystalSparrow'] },
                    { name: 'Builder', icon: '🔨', description: 'Makes it real', people: ['ShadowSparrow', 'RedMaple'] }
                ]
            },
            {
                id: 'structure',
                title: 'STRUCTURE',
                description: 'Cohesion Phase',
                roles: [
                    { name: 'Divider', icon: '🚧', description: 'Protects boundaries', people: ['RedWolf'] },
                    { name: 'Connector', icon: '🔗', description: 'Links people & resources', people: ['GoldenFox'] },
                    { name: 'Integrator', icon: '🔄', description: 'Weaves pieces together', people: ['BlueSparrow'] }
                ]
            },
            {
                id: 'continuity',
                title: 'CONTINUITY',
                description: 'Sustainability Phase',
                roles: [
                    { name: 'Balancer', icon: '⏰', description: 'Manages pace', people: ['BlueWolf'] },
                    { name: 'Overlayer', icon: '🗺️', description: 'Sees systems', people: [] },
                    { name: 'Reflector', icon: '📚', description: 'Captures lessons', people: [] }
                ]
            }
        ];

        const people = [
            { name: 'SilverFox', roles: ['Starter'] },
            { name: 'CrystalSparrow', roles: ['Definer'] },
            { name: 'ShadowSparrow', roles: ['Builder'] },
            { name: 'RedMaple', roles: ['Builder'] },
            { name: 'RedWolf', roles: ['Divider'] },
            { name: 'GoldenFox', roles: ['Connector'] },
            { name: 'BlueSparrow', roles: ['Integrator'] },
            { name: 'BlueWolf', roles: ['Balancer'] },
            { name: 'GreenOwl', roles: [] },
            { name: 'SilverEagle', roles: [] },
            { name: 'CrystalBear', roles: [] },
            { name: 'ShadowFox', roles: [] }
        ];

        const flows = [
            { 
                from: 'Starter', 
                operator: 'spot', 
                operand: 'emerging risks', 
                preposition: 'to', 
                to: 'Definer', 
                category: 'shares',
                timestamp: new Date(Date.now() - 7200000).toISOString(),
                consent: { from: 'approved', to: 'approved' }
            },
            { 
                from: 'Definer', 
                operator: 'define', 
                operand: 'success criteria', 
                preposition: 'for', 
                to: 'Builder', 
                category: 'shares',
                timestamp: new Date(Date.now() - 3600000).toISOString(),
                consent: { from: 'approved', to: 'pending' }
            },
            { 
                from: 'Builder', 
                operator: 'build', 
                operand: 'intake system', 
                preposition: 'with', 
                to: 'Connector', 
                category: 'does',
                timestamp: new Date(Date.now() - 1800000).toISOString(),
                consent: { from: 'approved', to: 'approved' }
            },
            { 
                from: 'Connector', 
                operator: 'connect', 
                operand: 'resource providers', 
                preposition: 'to', 
                to: 'Builder', 
                category: 'does',
                timestamp: new Date(Date.now() - 900000).toISOString(),
                consent: { from: 'pending', to: 'pending' }
            },
            { 
                from: 'Balancer', 
                operator: 'pace', 
                operand: 'sprint cycles', 
                preposition: 'for', 
                to: 'Builder', 
                category: 'okays',
                timestamp: new Date(Date.now() - 86400000).toISOString(),
                consent: { from: 'approved', to: 'approved' }
            }
        ];

        const tasks = [
            {
                id: 'T001',
                flowId: 0,
                title: 'Critical infrastructure risk identified',
                description: 'Power grid vulnerability detected in sector 7',
                from: 'Starter',
                to: 'Definer',
                operator: 'spot',
                category: 'shares',
                state: 'received',
                priority: 'high',
                created: new Date(Date.now() - 3600000).toISOString(),
                chain: ['T002']
            },
            {
                id: 'T002',
                flowId: 1,
                title: 'Define response criteria',
                description: 'Need clear success metrics for infrastructure protection',
                from: 'Definer',
                to: 'Builder',
                operator: 'define',
                category: 'shares',
                state: 'processing',
                priority: 'high',
                created: new Date(Date.now() - 1800000).toISOString(),
                chain: ['T003']
            },
            {
                id: 'T003',
                flowId: 2,
                title: 'Build emergency response system',
                description: 'Construct failsafe for identified vulnerability',
                from: 'Builder',
                to: 'Connector',
                operator: 'build',
                category: 'does',
                state: 'created',
                priority: 'high',
                created: new Date(Date.now() - 900000).toISOString(),
                chain: []
            }
        ];

        const categoryMap = {
            'shares': ['spot', 'define', 'bound', 'reflect'],
            'okays': ['integrate', 'pace'],
            'does': ['build', 'connect', 'protect']
        };

        // Custom dropdown functionality
        let selectedValues = {
            fromRole: '',
            preposition: 'to',
            toRole: ''
        };

        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            renderRoles();
        });

        // Tab switching
        function switchTab(tab, element) {
            currentTab = tab;
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const tabContent = document.getElementById(tab + 'Tab');
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            if (tab === 'people') {
                renderPeople();
            } else if (tab === 'flows') {
                renderFlows();
            } else if (tab === 'tasks') {
                renderTasks();
            } else if (tab === 'roles') {
                renderRoles();
            } else if (tab === 'network') {
                renderNetwork();
            }
        }

        // Toggle role view between icon and table
        function toggleRoleView(mode) {
            roleViewMode = mode;
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderRoles();
        }

        // Toggle triad collapse/expand
        function toggleTriad(triadId) {
            if (expandedTriads.has(triadId)) {
                expandedTriads.delete(triadId);
            } else {
                expandedTriads.add(triadId);
            }
            renderRoles();
        }

        // Render roles based on view mode
        function renderRoles() {
            const container = document.getElementById('triadsContainer');
            if (!container) return;
            
            if (roleViewMode === 'icon') {
                renderIconView(container);
            } else {
                renderTableView(container);
            }
        }

        // Render Icon View
        function renderIconView(container) {
            container.innerHTML = triadsData.map(triad => {
                const isExpanded = expandedTriads.has(triad.id);
                const filledCount = triad.roles.filter(r => r.people.length > 0).length;
                
                return `
                    <div class="triad ${isExpanded ? '' : 'collapsed'}">
                        <div class="triad-header" onclick="toggleTriad('${triad.id}')">
                            <div class="triad-info">
                                <span class="collapse-icon">▼</span>
                                <div>
                                    <div class="triad-title">${triad.title}</div>
                                    <div class="triad-description">${triad.description}</div>
                                </div>
                            </div>
                            <div class="triad-summary">
                                ${triad.roles.map(role => `
                                    <div class="role-indicator ${role.people.length > 0 ? 'filled' : 'empty'}"></div>
                                `).join('')}
                                <div class="triad-status">${filledCount}/${triad.roles.length} filled</div>
                            </div>
                        </div>
                        <div class="roles-content">
                            <div class="roles icon-view">
                                ${triad.roles.map(role => `
                                    <div class="role icon-view ${role.people.length > 0 ? 'filled' : 'empty'}" onclick="quickAdd('${role.name}')">
                                        <div class="role-compact">
                                            <div class="role-icon">${role.icon}</div>
                                            <div class="role-name">${role.name}</div>
                                            <div class="role-description" style="font-size: 0.75rem; color: var(--text-dim);">${role.description}</div>
                                            <div class="role-people-count ${role.people.length === 0 ? 'empty' : ''}">
                                                ${role.people.length > 0 ? `${role.people.length} person${role.people.length > 1 ? 's' : ''}` : 'Empty'}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render Table View
        function renderTableView(container) {
            container.innerHTML = triadsData.map(triad => {
                const isExpanded = expandedTriads.has(triad.id);
                const filledCount = triad.roles.filter(r => r.people.length > 0).length;
                
                return `
                    <div class="triad ${isExpanded ? '' : 'collapsed'}">
                        <div class="triad-header" onclick="toggleTriad('${triad.id}')">
                            <div class="triad-info">
                                <span class="collapse-icon">▼</span>
                                <div>
                                    <div class="triad-title">${triad.title}</div>
                                    <div class="triad-description">${triad.description}</div>
                                </div>
                            </div>
                            <div class="triad-summary">
                                ${triad.roles.map(role => `
                                    <div class="role-indicator ${role.people.length > 0 ? 'filled' : 'empty'}"></div>
                                `).join('')}
                                <div class="triad-status">${filledCount}/${triad.roles.length} filled</div>
                            </div>
                        </div>
                        <div class="roles-content">
                            <div class="roles table-view">
                                <table class="role-table">
                                    <thead>
                                        <tr>
                                            <th>Status</th>
                                            <th>Role</th>
                                            <th>Description</th>
                                            <th>People</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${triad.roles.map(role => `
                                            <tr>
                                                <td>
                                                    <div class="status-dot ${role.people.length > 0 ? 'filled' : 'empty'}"></div>
                                                </td>
                                                <td>
                                                    <div class="role-cell">
                                                        <span>${role.icon}</span>
                                                        <span style="font-weight: 600;">${role.name}</span>
                                                    </div>
                                                </td>
                                                <td style="color: var(--text-dim); font-size: 0.85rem;">
                                                    ${role.description}
                                                </td>
                                                <td>
                                                    <div class="people-tags">
                                                        ${role.people.length > 0 ? 
                                                            role.people.map((person, idx) => `
                                                                <span class="person-tag ${idx > 0 ? 'backup' : ''}">${person}</span>
                                                            `).join('') :
                                                            '<span class="empty-tag">Empty - Critical!</span>'
                                                        }
                                                    </div>
                                                </td>
                                                <td>
                                                    <button class="add-btn" onclick="quickAdd('${role.name}')">+ Add</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // People rendering
        function renderPeople() {
            const grid = document.getElementById('peopleGrid');
            if (!grid) return;
            
            grid.innerHTML = people.map(person => `
                <div class="person-card">
                    <div class="person-avatar">${person.name[0]}</div>
                    <div class="person-name">${person.name}</div>
                    <div class="person-role-count">${person.roles.length} role${person.roles.length !== 1 ? 's' : ''}</div>
                </div>
            `).join('');
        }

        // Flow rendering
        function getCoreOperator(operator) {
            for (const [core, ops] of Object.entries(categoryMap)) {
                if (ops.includes(operator)) return core;
            }
            return 'shares';
        }

        function renderFlows() {
            const list = document.getElementById('flowsList');
            if (!list) return;
            
            let displayFlows = flows.map(f => {
                let displayOperator = f.operator;
                if (viewMode === 'simple') {
                    displayOperator = f.category;
                }
                
                return {
                    ...f,
                    displayOperator: displayOperator
                };
            });

            list.innerHTML = displayFlows.map((flow, index) => {
                const timeAgo = getTimeAgo(flow.timestamp);
                const consentStatus = getConsentStatus(flow.consent);
                const needsConsent = flow.consent.from === 'pending' || flow.consent.to === 'pending';
                
                return `
                <div class="flow-item ${flow.category}-flow">
                    <div class="flow-content">
                        <div class="flow-role">${flow.from}</div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-operator">${flow.displayOperator}</div>
                        <div class="flow-operand">"${flow.operand}"</div>
                        <span class="flow-arrow">${flow.preposition}</span>
                        <div class="flow-role">${flow.to}</div>
                    </div>
                    <div class="flow-meta">
                        <div class="flow-timestamp">${timeAgo}</div>
                        <div class="flow-consent">
                            <div class="consent-status ${consentStatus.class}">
                                <span class="consent-dot"></span>
                                ${consentStatus.text}
                            </div>
                            ${needsConsent ? `
                                <button class="consent-btn" onclick="approveFlow(${index})">Approve</button>
                                <button class="consent-btn reject" onclick="rejectFlow(${index})">Reject</button>
                            ` : ''}
                        </div>
                        <div class="flow-actions">
                            <button class="flow-btn" onclick="editFlow(${index})">Edit</button>
                            <button class="flow-btn" onclick="deleteFlow(${index})">Delete</button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function getTimeAgo(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'just now';
            if (minutes < 60) return `${minutes} min ago`;
            if (hours < 24) return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            return `${days} day${days !== 1 ? 's' : ''} ago`;
        }

        function getConsentStatus(consent) {
            if (consent.from === 'approved' && consent.to === 'approved') {
                return { text: 'Active', class: 'approved' };
            } else if (consent.from === 'rejected' || consent.to === 'rejected') {
                return { text: 'Rejected', class: 'rejected' };
            } else {
                return { text: 'Pending', class: 'pending' };
            }
        }

        function approveFlow(index) {
            const flow = flows[index];
            if (flow.consent.from === 'pending') {
                flow.consent.from = 'approved';
            }
            if (flow.consent.to === 'pending') {
                flow.consent.to = 'approved';
            }
            renderFlows();
        }

        function rejectFlow(index) {
            const flow = flows[index];
            flow.consent.from = 'rejected';
            renderFlows();
        }

        function setView(mode) {
            viewMode = mode;
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderFlows();
        }

        // Tasks rendering
        function renderTasks() {
            const list = document.getElementById('flowTaskList');
            if (!list) return;
            
            const tasksByFlow = {};
            const approvedFlows = flows.filter(f => f.consent.from === 'approved' && f.consent.to === 'approved');
            
            approvedFlows.forEach((flow, index) => {
                const flowKey = `flow-${index}`;
                tasksByFlow[flowKey] = {
                    flow: flow,
                    flowIndex: index,
                    tasks: tasks.filter(t => t.flowId === index)
                };
            });
            
            list.innerHTML = Object.entries(tasksByFlow).map(([flowKey, data]) => {
                const isExpanded = expandedFlows.has(flowKey);
                const states = ['created', 'transmitted', 'received', 'processing', 'completed'];
                const taskCounts = states.reduce((acc, state) => {
                    acc[state] = data.tasks.filter(t => t.state === state).length;
                    return acc;
                }, {});
                
                return `
                    <div class="flow-task-group ${isExpanded ? '' : 'collapsed'}" data-flow="${flowKey}">
                        <div class="flow-task-header" onclick="toggleFlowTasks('${flowKey}')">
                            <div class="flow-task-header-content">
                                <div class="flow-info">
                                    <span class="flow-expand-icon">▼</span>
                                    <div class="flow-path">
                                        <span class="role">${data.flow.from}</span>
                                        <span>→</span>
                                        <span class="operator ${data.flow.category}-operator">${data.flow.operator}</span>
                                        <span class="flow-operand" style="color: var(--text-dim); font-style: italic;">
                                            "${data.flow.operand}"
                                        </span>
                                        <span>→</span>
                                        <span class="role">${data.flow.to}</span>
                                    </div>
                                </div>
                                <div class="flow-stats">
                                    <div class="flow-stat">
                                        <span class="stat-value">${data.tasks.length}</span>
                                        <span class="stat-label">tasks</span>
                                    </div>
                                    <div class="flow-stat">
                                        <span class="stat-value" style="color: var(--green);">${taskCounts.completed || 0}</span>
                                        <span class="stat-label">done</span>
                                    </div>
                                    <button class="create-task-btn" onclick="createTaskInFlow(event, ${data.flowIndex})">
                                        + Task
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flow-task-content">
                            ${data.tasks.length > 0 ? `
                                <div class="task-columns">
                                    ${states.map(state => `
                                        <div class="task-column">
                                            <div class="task-column-header">${state}</div>
                                            <div class="task-column-content">
                                                ${data.tasks
                                                    .filter(t => t.state === state)
                                                    .map(task => renderTaskCard(task))
                                                    .join('') || ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="empty-state">
                                    <div class="empty-state-icon">📭</div>
                                    <div>No tasks in this flow</div>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTaskCard(task) {
            const hasChain = task.chain && task.chain.length > 0;
            return `
                <div class="task-card ${task.category}-task">
                    <div class="task-header">
                        <span class="task-id">#${task.id}</span>
                        <span class="task-priority ${task.priority}"></span>
                    </div>
                    <div class="task-title">${task.title}</div>
                    <div class="task-meta">
                        <div class="task-chain-indicator">
                            ${hasChain ? `
                                <span class="chain-dot"></span>
                                <span class="chain-line"></span>
                                <span class="chain-count">${task.chain.length}</span>
                            ` : ''}
                        </div>
                        <div class="task-assignee">${task.to}</div>
                    </div>
                </div>
            `;
        }

        function toggleFlowTasks(flowKey) {
            if (expandedFlows.has(flowKey)) {
                expandedFlows.delete(flowKey);
            } else {
                expandedFlows.add(flowKey);
            }
            renderTasks();
        }

        function createTaskInFlow(event, flowIndex) {
            event.stopPropagation();
            alert(`Creating task for flow ${flowIndex}`);
        }

        function filterTasks() {
            const filter = document.getElementById('taskFilter').value;
            console.log('Filtering tasks by:', filter);
            renderTasks();
        }

        // Modal and dropdowns
        function toggleDropdown(selectId) {
            const selectElement = document.getElementById(selectId + 'Select');
            const trigger = selectElement.querySelector('.select-trigger');
            const options = selectElement.querySelector('.select-options');
            
            document.querySelectorAll('.custom-select').forEach(sel => {
                if (sel.id !== selectId + 'Select') {
                    sel.querySelector('.select-trigger').classList.remove('active');
                    sel.querySelector('.select-options').classList.remove('active');
                }
            });
            
            trigger.classList.toggle('active');
            options.classList.toggle('active');
            
            document.addEventListener('click', function closeDropdown(e) {
                if (!selectElement.contains(e.target)) {
                    trigger.classList.remove('active');
                    options.classList.remove('active');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }

        function selectOption(selectId, value) {
            const selectElement = document.getElementById(selectId + 'Select');
            const valueSpan = selectElement.querySelector('.select-value');
            const trigger = selectElement.querySelector('.select-trigger');
            const options = selectElement.querySelector('.select-options');
            
            valueSpan.textContent = value;
            valueSpan.setAttribute('data-value', value);
            
            selectElement.querySelectorAll('.select-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === value) {
                    opt.classList.add('selected');
                }
            });
            
            selectedValues[selectId] = value;
            
            trigger.classList.remove('active');
            options.classList.remove('active');
            
            event.stopPropagation();
        }

        function selectCoreCategory(category) {
            selectedCoreCategory = category;
            
            document.querySelectorAll('[data-core]').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-core="${category}"]`).classList.add('selected');
            
            document.getElementById('detailedOperatorRow').style.display = 'block';
            populateDetailedOperators(category);
        }
        
        function populateDetailedOperators(category) {
            const grid = document.getElementById('operatorGrid');
            const operators = categoryMap[category] || [];
            
            grid.innerHTML = operators.map(op => `
                <div class="operator-option ${category}" data-op="${op}" onclick="selectModalOperator(this)">
                    ${op}
                </div>
            `).join('');
            
            grid.style.gridTemplateColumns = operators.length === 4 ? 'repeat(2, 1fr)' : 
                                              operators.length === 3 ? 'repeat(3, 1fr)' : 
                                              'repeat(2, 1fr)';
        }

        function selectOperator(op, cat) {
            selectedOperator = op;
            selectedCategory = cat;
            selectedCoreCategory = cat;
            openFlowBuilder();
            
            selectCoreCategory(cat);
            
            setTimeout(() => {
                document.querySelectorAll('#operatorGrid .operator-option').forEach(opt => {
                    if (opt.dataset.op === op) {
                        opt.classList.add('selected');
                    }
                });
            }, 100);
        }

        function selectModalOperator(element) {
            document.querySelectorAll('#operatorGrid .operator-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedOperator = element.dataset.op;
        }

        function openFlowBuilder() {
            document.getElementById('flowModal').classList.add('active');
            selectedCoreCategory = null;
            document.getElementById('detailedOperatorRow').style.display = 'none';
        }

        function closeModal() {
            document.getElementById('flowModal').classList.remove('active');
            selectedValues = { fromRole: '', preposition: 'to', toRole: '' };
            document.getElementById('operand').value = '';
            document.querySelectorAll('.operator-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            selectedOperator = null;
            selectedCategory = null;
            selectedCoreCategory = null;
            document.getElementById('detailedOperatorRow').style.display = 'none';
        }

        function createFlow() {
            const fromRole = selectedValues.fromRole;
            const operand = document.getElementById('operand').value;
            const preposition = selectedValues.preposition;
            const toRole = selectedValues.toRole;

            if (fromRole && operand && toRole && selectedCoreCategory) {
                const operator = selectedOperator || selectedCoreCategory;
                
                flows.push({
                    from: fromRole,
                    operator: operator,
                    operand: operand,
                    preposition: preposition,
                    to: toRole,
                    category: selectedCoreCategory,
                    timestamp: new Date().toISOString(),
                    consent: { from: 'pending', to: 'pending' }
                });
                
                renderFlows();
                closeModal();
            } else {
                alert('Please fill in all fields and select a core operator category');
            }
        }

        function editFlow(index) {
            alert(`Edit flow ${index}`);
        }

        function deleteFlow(index) {
            if (confirm('Delete this flow?')) {
                flows.splice(index, 1);
                renderFlows();
            }
        }

        function quickAdd(role) {
            const name = prompt(`Add person to ${role} role:`);
            if (name) {
                alert(`Adding ${name} to ${role}`);
            }
        }

        // Network tab functions
        function renderNetwork() {
            renderConnectedPods();
            renderPodFlows();
        }

        function renderConnectedPods() {
            const container = document.getElementById('connectedPods');
            if (!container) return;

            container.innerHTML = `
                ${connectedPods.map(pod => `
                    <div class="pod-card">
                        <div class="pod-card-header">
                            <div class="pod-name">${pod.name}</div>
                            <div class="pod-health">
                                <span class="health-value">${pod.health}%</span>
                                <span style="color: var(--text-dim);">health</span>
                            </div>
                        </div>
                        <div class="pod-stats">
                            <div class="pod-stat">
                                <span class="pod-stat-value">${pod.rolesFilled}/${pod.totalRoles}</span>
                                <span class="pod-stat-label">roles</span>
                            </div>
                            <div class="pod-stat">
                                <span class="pod-stat-value">${pod.activeFlows}</span>
                                <span class="pod-stat-label">flows</span>
                            </div>
                        </div>
                        <div class="pod-flows">
                            <div class="pod-flow-count">CONNECTION TYPES</div>
                            <div class="pod-flow-indicators">
                                ${pod.flowTypes.shares > 0 ? `<div class="flow-indicator shares" style="flex: ${pod.flowTypes.shares}"></div>` : ''}
                                ${pod.flowTypes.does > 0 ? `<div class="flow-indicator does" style="flex: ${pod.flowTypes.does}"></div>` : ''}
                                ${pod.flowTypes.okays > 0 ? `<div class="flow-indicator okays" style="flex: ${pod.flowTypes.okays}"></div>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('')}
                <button class="add-pod-btn" onclick="addNewPod()">
                    <div class="add-pod-icon">+</div>
                    <div>Connect New Pod</div>
                </button>
            `;
        }

        function renderPodFlows() {
            const container = document.getElementById('podFlowsList');
            if (!container) return;

            let displayFlows = podFlows;
            
            if (flowTypeFilter === 'incoming') {
                displayFlows = podFlows.filter(f => f.to === 'NORTHSIDE RESPONSE' || (f.toRole && f.to === 'NORTHSIDE RESPONSE'));
            } else if (flowTypeFilter === 'outgoing') {
                displayFlows = podFlows.filter(f => f.from === 'NORTHSIDE RESPONSE');
            }

            container.innerHTML = displayFlows.map((flow, index) => {
                let fromDisplay = flow.from;
                let toDisplay = flow.to;
                
                if (flow.fromRole) {
                    fromDisplay = `${flow.from}.${flow.fromRole}`;
                }
                if (flow.toRole) {
                    toDisplay = `${flow.to}.${flow.toRole}`;
                }

                const timeAgo = getTimeAgo(flow.timestamp);
                const consentStatus = getConsentStatus(flow.consent);

                return `
                    <div class="pod-flow-item ${flow.category}-flow">
                        <div class="pod-flow-content">
                            <div class="pod-badge">${flow.type === 'pod-to-pod' ? 'POD' : flow.type === 'role-to-role' ? 'ROLE' : 'MIXED'}</div>
                            <span style="font-weight: 600;">${fromDisplay}</span>
                            <span class="flow-arrow">→</span>
                            <div class="flow-operator">${flow.operator}</div>
                            <div class="flow-operand" style="font-style: italic; color: var(--text-dim);">"${flow.operand}"</div>
                            <span class="flow-arrow">→</span>
                            <span style="font-weight: 600;">${toDisplay}</span>
                        </div>
                        <div class="flow-meta">
                            <div class="flow-timestamp">${timeAgo}</div>
                            <div class="consent-status ${consentStatus.class}">
                                <span class="consent-dot"></span>
                                ${consentStatus.text}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function setFlowType(type) {
            flowTypeFilter = type;
            document.querySelectorAll('.flow-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderPodFlows();
        }

        function openPodFlowBuilder() {
            document.getElementById('podFlowModal').classList.add('active');
            setPodFlowType('pod-to-pod');
        }

        function closePodModal() {
            document.getElementById('podFlowModal').classList.remove('active');
            // Reset form
            selectedValues.podFromRole = '';
            selectedValues.toPod = '';
            selectedValues.podToRole = '';
            document.getElementById('podOperand').value = '';
            selectedPodCoreCategory = null;
        }

        function setPodFlowType(type) {
            podFlowType = type;
            
            document.querySelectorAll('[data-type]').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            
            // Show/hide appropriate fields
            const fromRoleRow = document.getElementById('podFromRoleRow');
            const toRoleRow = document.getElementById('podToRoleRow');
            
            if (type === 'pod-to-pod') {
                fromRoleRow.style.display = 'none';
                toRoleRow.style.display = 'none';
            } else if (type === 'role-to-role') {
                fromRoleRow.style.display = 'block';
                toRoleRow.style.display = 'block';
            } else if (type === 'pod-to-role') {
                fromRoleRow.style.display = 'none';
                toRoleRow.style.display = 'block';
            }
        }

        function selectPodCoreCategory(category) {
            selectedPodCoreCategory = category;
            
            document.querySelectorAll('#podFlowModal [data-core]').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`#podFlowModal [data-core="${category}"]`).classList.add('selected');
        }

        function createPodFlow() {
            const from = 'NORTHSIDE RESPONSE';
            const fromRole = podFlowType !== 'pod-to-pod' ? selectedValues.podFromRole : null;
            const operand = document.getElementById('podOperand').value;
            const to = selectedValues.toPod;
            const toRole = podFlowType === 'role-to-role' || podFlowType === 'pod-to-role' ? selectedValues.podToRole : null;
            
            if (!operand || !to || !selectedPodCoreCategory) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (podFlowType === 'role-to-role' && (!fromRole || !toRole)) {
                alert('Please select both from and to roles for role-to-role connection');
                return;
            }
            
            if (podFlowType === 'pod-to-role' && !toRole) {
                alert('Please select target role');
                return;
            }
            
            podFlows.push({
                type: podFlowType,
                from: from,
                fromRole: fromRole,
                operator: selectedPodCoreCategory,
                operand: operand,
                to: to,
                toRole: toRole,
                category: selectedPodCoreCategory,
                timestamp: new Date().toISOString(),
                consent: { from: 'pending', to: 'pending' }
            });
            
            // If connecting to a new pod, add it to connected pods
            if (to === '[New Pod]') {
                const newPodName = prompt('Enter new pod name:');
                if (newPodName) {
                    connectedPods.push({
                        name: newPodName,
                        health: 75,
                        rolesFilled: 0,
                        totalRoles: 9,
                        activeFlows: 1,
                        flowTypes: { shares: 0, does: 0, okays: 0 }
                    });
                    podFlows[podFlows.length - 1].to = newPodName;
                }
            }
            
            renderNetwork();
            closePodModal();
        }

        function addNewPod() {
            openPodFlowBuilder();
        }
    </script>
</body>
</html>
